# æ­£åˆ™è¡¨è¾¾å¼åº“é€‰æ‹©æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®æ”¯æŒä¸¤ç§æ­£åˆ™è¡¨è¾¾å¼åº“ï¼š
1. **RE2** - Google å¼€å‘çš„é«˜æ€§èƒ½æ­£åˆ™è¡¨è¾¾å¼åº“ï¼Œæ”¯æŒå®Œæ•´çš„ Unicode
2. **std::regex** - C++ æ ‡å‡†åº“çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ŒUnicode æ”¯æŒæœ‰é™

æ‚¨å¯ä»¥é€šè¿‡ CMake é…ç½®é€‰é¡¹é€‰æ‹©ä½¿ç”¨å“ªä¸ªåº“ã€‚

## ğŸ”§ é…ç½®æ–¹æ³•

### ä½¿ç”¨ RE2ï¼ˆæ¨èï¼Œé»˜è®¤ï¼‰

```bash
cd Transformer_cpp
mkdir build && cd build
cmake -DUSE_RE2=ON ..
cmake --build .
```

æˆ–è€…ç›´æ¥è¿è¡Œï¼ˆé»˜è®¤å°±æ˜¯ ONï¼‰ï¼š

```bash
cmake ..
cmake --build .
```

### ä½¿ç”¨ std::regex

```bash
cd Transformer_cpp
mkdir build && cd build
cmake -DUSE_RE2=OFF ..
cmake --build .
```

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| ç‰¹æ€§ | RE2 | std::regex |
|------|-----|-----------|
| Unicode å±æ€§ç±» (`\p{L}`, `\p{N}`) | âœ… å®Œæ•´æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| Unicode å­—ç¬¦åŒ¹é… | âœ… å®Œæ•´æ”¯æŒ | âš ï¸ éƒ¨åˆ†æ”¯æŒ |
| æ€§èƒ½ | âœ… é«˜æ€§èƒ½ | âš ï¸ ä¸­ç­‰ |
| ä¾èµ–é¡¹ | âš ï¸ éœ€è¦ RE2 åº“ | âœ… æ— é¢å¤–ä¾èµ– |
| ç¼–è¯‘æ—¶é—´ | âš ï¸ éœ€è¦ç¼–è¯‘ RE2 | âœ… å¿«é€Ÿ |
| äºŒè¿›åˆ¶å¤§å° | âš ï¸ ç¨å¤§ | âœ… è¾ƒå° |

## ğŸ¯ ä½¿ç”¨å»ºè®®

### æ¨èä½¿ç”¨ RE2 çš„åœºæ™¯

- âœ… éœ€è¦å¤„ç†å¤šè¯­è¨€æ–‡æœ¬ï¼ˆä¸­æ–‡ã€æ—¥æ–‡ã€é˜¿æ‹‰ä¼¯æ–‡ç­‰ï¼‰
- âœ… éœ€è¦å®Œæ•´çš„ Unicode æ”¯æŒ
- âœ… å¯¹æ€§èƒ½æœ‰è¾ƒé«˜è¦æ±‚
- âœ… éœ€è¦ä¸ OpenAI tiktoken å®Œå…¨å…¼å®¹

### æ¨èä½¿ç”¨ std::regex çš„åœºæ™¯

- âœ… åªå¤„ç† ASCII æˆ–åŸºæœ¬æ‹‰ä¸å­—ç¬¦
- âœ… å¸Œæœ›å‡å°‘ä¾èµ–é¡¹
- âœ… å¸Œæœ›åŠ å¿«ç¼–è¯‘é€Ÿåº¦
- âœ… äºŒè¿›åˆ¶å¤§å°æ•æ„Ÿçš„åœºæ™¯

## ğŸ” éªŒè¯å½“å‰é…ç½®

åœ¨ CMake é…ç½®é˜¶æ®µï¼Œä¼šæ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„åº“ï¼š

```
========================================
Using RE2 library for regex support
========================================
```

æˆ–

```
========================================
Using std::regex for regex support
Note: std::regex has limited Unicode support
========================================
```

## ğŸ“ ä»£ç ä¸­çš„å¤„ç†

ä»£ç ä½¿ç”¨æ¡ä»¶ç¼–è¯‘è‡ªåŠ¨å¤„ç†ä¸¤ç§æ¨¡å¼ï¼š

```cpp
#ifdef TIKTOKEN_USE_RE2
    // ä½¿ç”¨ RE2ï¼ˆå®Œæ•´ Unicode æ”¯æŒï¼‰
    RE2::FindAndConsume(&input, *regex_pattern_, &match_str);
#else
    // ä½¿ç”¨ std::regexï¼ˆç®€åŒ– Unicode æ”¯æŒï¼‰
    std::regex pattern(regex_pattern);
#endif
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: RE2 ç¼–è¯‘å¤±è´¥

**ç—‡çŠ¶**: ä½¿ç”¨ `-DUSE_RE2=ON` æ—¶ç¼–è¯‘å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ˆéœ€è¦ä¸‹è½½ RE2ï¼‰
2. æˆ–ä½¿ç”¨ç³»ç»Ÿå®‰è£…çš„ RE2ï¼š
   ```bash
   # Linux
   sudo apt-get install libre2-dev
   
   # macOS
   brew install re2
   ```
3. æˆ–åˆ‡æ¢åˆ° std::regexï¼š
   ```bash
   cmake -DUSE_RE2=OFF ..
   ```

### é—®é¢˜ 2: Unicode å­—ç¬¦åŒ¹é…ä¸æ­£ç¡®

**ç—‡çŠ¶**: ä½¿ç”¨ std::regex æ—¶ï¼ŒæŸäº› Unicode å­—ç¬¦åŒ¹é…ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
åˆ‡æ¢åˆ° RE2ï¼š
```bash
cmake -DUSE_RE2=ON ..
```

### é—®é¢˜ 3: é“¾æ¥é”™è¯¯

**ç—‡çŠ¶**: é“¾æ¥æ—¶æ‰¾ä¸åˆ° RE2 åº“

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ RE2 å·²æ­£ç¡®æ„å»º
2. æ£€æŸ¥ `target_link_libraries` æ˜¯å¦æ­£ç¡®
3. æˆ–åˆ‡æ¢åˆ° std::regex

## ğŸ“š å‚è€ƒ

- [RE2 GitHub](https://github.com/google/re2)
- [std::regex æ–‡æ¡£](https://en.cppreference.com/w/cpp/regex)
- [Unicode æ­£åˆ™è¡¨è¾¾å¼](https://www.regular-expressions.info/unicode.html)

---

**æœ€åæ›´æ–°**ï¼š2026-01-01  
**ç‰ˆæœ¬**ï¼š1.0

